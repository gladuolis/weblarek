https://github.com/gladuolis/weblarek#

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TypeScript, Vite

## Структура проекта

- `src/` — исходные файлы проекта
- `src/components/` — папка с компонентами
- `src/components/base/` — папка с базовым кодом
- `src/components/models/` — папка с моделями данных
- `src/components/Api/` — папка с API-клиентом

## Важные файлы

- `index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами данных
- `src/vendor/main.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды:

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Превью собранного проекта

```
npm run preview
```

или

```
yarn preview
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

- **Model** - слой данных, отвечает за хранение и изменение данных
- **View** - слой представления, отвечает за отображение данных на странице  
- **Presenter** - презентер содержит основную логику приложения и отвечает за связь представления и данных

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

## Базовый код

### Класс Component

Является базовым классом для всех компонентов интерфейса. Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

**Конструктор:**
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

**Поля класса:**
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

**Методы класса:**
`render(data?: Partial<T>): HTMLElement` - главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.

`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`.

### Класс Api

Содержит в себе базовую логику отправки запросов.

**Конструктор:**
`constructor(baseUrl: string, options: RequestInit = {})` - в конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

**Поля класса:**
`baseUrl: string` - базовый адрес сервера
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

**Методы:**
`get<T extends object>(uri: string): Promise<T>` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер.

`post<T extends object>(uri: string, data: object, method?: ApiPostMethods): Promise<T>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

`handleResponse<T>(response: Response): Promise<T>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

**Конструктор класса** не принимает параметров.

**Поля класса:**
`_events: Map<string | RegExp, Set<Function>>` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

**Методы класса:**
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.

`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.

`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

## Данные

### Интерфейсы

**IProduct** - описывает структуру товара:
- `id: string` - уникальный идентификатор
- `description: string` - описание товара
- `image: string` - путь к изображению
- `title: string` - название товара
- `category: string` - категория товара
- `price: number | null` - цена (может быть null если товар недоступен)

**TPayment** - тип для способа оплаты:
- `'card' | 'cash'` - возможные значения

**IBuyer** - описывает данные покупателя:
- `payment: TPayment` - способ оплаты
- `email: string` - email покупателя
- `phone: string` - телефон покупателя
- `address: string` - адрес доставки

**IOrder** - описывает данные для отправки заказа на сервер:
- `payment: TPayment` - способ оплаты
- `email: string` - email покупателя
- `phone: string` - телефон покупателя
- `address: string` - адрес доставки
- `total: number` - общая стоимость заказа
- `items: string[]` - массив ID товаров

**ApiListResponse<T>** - описывает ответ от API для списков с пагинацией:
- `total: number` - общее количество элементов
- `items: T[]` - массив элементов

**IValidationErrors** - описывает ошибки валидации данных покупателя:
- `payment?: string` - ошибка способа оплаты
- `email?: string` - ошибка email
- `phone?: string` - ошибка телефона
- `address?: string` - ошибка адреса

## Модели данных

### ProductModel

**Назначение:** хранение каталога товаров и выбранного товара для подробного просмотра

**Конструктор:** не принимает параметров

**Поля:**
- `items: IProduct[]` - массив всех товаров
- `selectedItem: IProduct | null` - выбранный для просмотра товар

**Методы:**
- `setItems(items: IProduct[]): void` - сохраняет массив товаров
- `getItems(): IProduct[]` - возвращает массив всех товаров
- `getItemById(id: string): IProduct | undefined` - возвращает товар по ID
- `setSelectedItem(item: IProduct): void` - сохраняет товар для подробного отображения
- `getSelectedItem(): IProduct | null` - возвращает выбранный товар

### CartModel

**Назначение:** хранение товаров в корзине покупок

**Конструктор:** не принимает параметров

**Поля:**
- `items: IProduct[]` - массив товаров в корзине

**Методы:**
- `getItems(): IProduct[]` - возвращает массив товаров в корзине
- `addItem(item: IProduct): void` - добавляет товар в корзину
- `removeItem(item: IProduct): void` - удаляет товар из корзины
- `clearCart(): void` - очищает корзину
- `getTotalPrice(): number` - возвращает общую стоимость товаров в корзине
- `getItemsCount(): number` - возвращает количество товаров в корзине
- `containsItem(id: string): boolean` - проверяет наличие товара в корзине по ID

### BuyerModel

**Назначение:** хранение и валидация данных покупателя

**Конструктор:** не принимает параметров

**Поля:**
- `payment: TPayment | null` - способ оплаты
- `email: string` - email покупателя
- `phone: string` - телефон покупателя
- `address: string` - адрес доставки

**Методы:**
- `setData(data: Partial<IBuyer>): void` - сохраняет данные покупателя (частично или полностью)
- `getData(): IBuyer | null` - возвращает все данные покупателя
- `clearData(): void` - очищает данные покупателя
- `validate(): IValidationErrors` - проверяет валидность данных и возвращает объект с ошибками
- `isValid(): boolean` - проверяет, все ли данные валидны

## Слой коммуникации

### WebLarekAPI

**Назначение:** взаимодействие с сервером API для получения товаров и отправки заказов

**Конструктор:**
constructor(api: IApi) - принимает экземпляр класса, реализующего интерфейс IApi

**Методы:**
- `getProductList(): Promise<ApiListResponse<IProduct>>` - получает список товаров с сервера
- `submitOrder(order: IOrder): Promise<{ id: string; total: number }>` - отправляет заказ на сервер


## Компоненты представления (View)

### CatalogCard

**Назначение:** отображение карточки товара в каталоге

**Конструктор:**
`constructor(container: HTMLElement, onClick?: (product: IProduct) => void)` - принимает контейнер и обработчик клика

**Поля:**
- `_button: HTMLButtonElement` - кнопка карточки
- `_title: HTMLElement` - заголовок товара
- `_image: HTMLImageElement` - изображение товара
- `_category: HTMLElement` - категория товара
- `_price: HTMLElement` - цена товара

**Методы:**
- `render(data: IProduct): HTMLElement` - заполняет карточку данными товара

### PreviewCard

**Назначение:** отображение детальной информации о товаре в модальном окне

**Конструктор:**
`constructor(container: HTMLElement, onAddToBasket?: (product: IProduct) => void)` - принимает контейнер и обработчик добавления в корзину

**Поля:**
- `_title: HTMLElement` - заголовок товара
- `_image: HTMLImageElement` - изображение товара
- `_category: HTMLElement` - категория товара
- `_description: HTMLElement` - описание товара
- `_price: HTMLElement` - цена товара
- `_button: HTMLButtonElement` - кнопка "В корзину"

**Методы:**
- `render(data: IProduct): HTMLElement` - заполняет карточку данными товара

### BasketCard

**Назначение:** отображение товара в корзине

**Конструктор:**
`constructor(container: HTMLElement, onDelete?: (product: IProduct) => void)` - принимает контейнер и обработчик удаления

**Поля:**
- `_title: HTMLElement` - название товара
- `_price: HTMLElement` - цена товара
- `_deleteButton: HTMLButtonElement` - кнопка удаления
- `_index: HTMLElement` - порядковый номер

**Методы:**
- `render(data: IProduct, index: number): HTMLElement` - заполняет карточку данными товара

### BasketView

**Назначение:** отображение всей корзины товаров

**Конструктор:**
`constructor(container: HTMLElement, onCheckout?: () => void, onDelete?: (product: IProduct) => void)` - принимает контейнер и обработчики оформления заказа и удаления товаров

**Поля:**
- `_list: HTMLElement` - список товаров
- `_total: HTMLElement` - общая стоимость
- `_button: HTMLButtonElement` - кнопка оформления
- `_emptyMessage: HTMLElement` - сообщение о пустой корзине

**Методы:**
- `render(items: IProduct[], total: number): HTMLElement` - отображает корзину с товарами

### OrderForm

**Назначение:** форма оформления заказа (первый шаг)

**Конструктор:**
`constructor(container: HTMLElement, onSubmit?: (data: { payment: TPayment; address: string }) => void)` - принимает контейнер и обработчик отправки формы

**Поля:**
- `_form: HTMLFormElement` - форма
- `_cardButton: HTMLButtonElement` - кнопка оплаты картой
- `_cashButton: HTMLButtonElement` - кнопка оплаты наличными
- `_addressInput: HTMLInputElement` - поле адреса
- `_submitButton: HTMLButtonElement` - кнопка "Далее"
- `_errors: HTMLElement` - блок ошибок

**Методы:**
- `render(): HTMLElement` - сбрасывает и отображает форму
- `selectPayment(payment: TPayment): void` - выбирает способ оплаты
- `validateForm(): boolean` - проверяет валидность формы

### ContactsForm

**Назначение:** форма контактов (второй шаг оформления заказа)

**Конструктор:**
`constructor(container: HTMLElement, onSubmit?: (data: { email: string; phone: string }) => void)` - принимает контейнер и обработчик отправки формы

**Поля:**
- `_form: HTMLFormElement` - форма
- `_emailInput: HTMLInputElement` - поле email
- `_phoneInput: HTMLInputElement` - поле телефона
- `_submitButton: HTMLButtonElement` - кнопка "Оплатить"
- `_errors: HTMLElement` - блок ошибок

**Методы:**
- `render(): HTMLElement` - сбрасывает и отображает форму
- `validateForm(): boolean` - проверяет валидность формы

### Modal

**Назначение:** управление модальным окном

**Конструктор:**
`constructor(container: HTMLElement)` - принимает контейнер модального окна

**Поля:**
- `_container: HTMLElement` - контейнер модального окна
- `_closeButton: HTMLButtonElement` - кнопка закрытия

**Методы:**
- `open(): void` - открывает модальное окно
- `close(): void` - закрывает модальное окно
- `setContent(content: HTMLElement): void` - устанавливает содержимое

## События

### События моделей данных

- `products:changed` - генерируется при изменении каталога товаров
- `product:selected` - генерируется при выборе товара для просмотра
- `cart:changed` - генерируется при изменении содержимого корзины
- `buyer:changed` - генерируется при изменении данных покупателя

### События представлений

- Клик на карточку товара в каталоге - открывает модальное окно просмотра
- Клик на кнопку "В корзину" - добавляет товар в корзину
- Клик на кнопку удаления в корзине - удаляет товар из корзины
- Клик на иконку корзины - открывает корзину
- Клик на кнопку "Оформить" - открывает форму заказа
- Клик на кнопку "Далее" - открывает форму контактов
- Клик на кнопку "Оплатить" - отправляет заказ на сервер
- Изменение данных в формах - запускает валидацию

## Презентер

### AppPresenter

**Назначение:** основной класс, управляющий логикой приложения и связывающий модели с представлениями

**Конструктор:**
`constructor(productModel: ProductModel, cartModel: CartModel, buyerModel: BuyerModel, api: WebLarekAPI, modal: Modal, gallery: HTMLElement, basketButton: HTMLElement)` - принимает все необходимые компоненты приложения

**Основные методы:**
- `init(): void` - инициализирует приложение
- `loadProducts(): Promise<void>` - загружает товары с сервера
- `renderCatalog(): void` - отображает каталог товаров
- `openProductModal(product: IProduct): void` - открывает модальное окно просмотра товара
- `addToBasket(product: IProduct): void` - добавляет товар в корзину
- `openBasket(): void` - открывает корзину
- `removeFromBasket(product: IProduct): void` - удаляет товар из корзины
- `updateBasketCounter(): void` - обновляет счетчик корзины
- `openOrderForm(): void` - открывает форму заказа
- `openContactsForm(): void` - открывает форму контактов
- `submitOrder(): Promise<void>` - отправляет заказ на сервер
- `showSuccess(total: number): void` - показывает сообщение об успешном заказе

**Логика работы:**
Презентер подписывается на события моделей и обрабатывает действия пользователя из представлений. При изменении данных в моделях презентер обновляет соответствующие представления. Вся бизнес-логика приложения сосредоточена в презентере.
